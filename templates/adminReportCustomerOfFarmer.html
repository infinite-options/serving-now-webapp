<!DOCTYPE html>
<html>
  <head>
    <title>Admin Order Report</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type=text/javascript>

    </script>
  </head>
  <body>

    {% extends "main.html" %}

    {% block content %}
      <script src="ordermeal.js"></script>
      <link rel="stylesheet" type="text/css" href="{{ url_for('.static', filename='css/reportStyle.css' )}}">

      <main role="main" class="container-fluid">
        <div class="row">
          <div class="col-md-8">
            <div class="border-bottom mb-4 ml-4 d-flex justify-content-between">  <!-- this is spacing below Join Today text -->
              <span class="display-4 page-header-title">Admin Order Report</span>
            </div>

            <div class="mb-4 ml-4 d-flex justify-content-between">  <!-- this is spacing below Join Today text -->
              <span class="display-4 page-header-title">Filters: </span>
              <button class="btn btn-default btn-sm " type="button" >
                <a href="{{ url_for('adminreportFilter', sort='1') }}">Farmer by Item</a>
              </button>
              <button class="btn btn-defualt btn-sm " type="button">
                <a href="{{ url_for('adminreportFilter', sort='2') }}">Farmer by Customer</a>
              </button>
              <button class="btn btn-defualt btn-sm " type="button">
                <a href="{{ url_for('adminreportFilter', sort='3') }}">Customer by Item</a>
              </button>
            </div>

            <div class="border-top ml-4 p-2 mb-1 mt-1">
            <table class='table table-borderless mb-0'>
              <tbody>
                <tr>
                  <td class="time-col align-middle table-borderless" scope="col">order time</td>
                  <td class="phone-col align-middle table-borderless" scope="col">kitchen_id</td>
                  <th class="name-col align-middle table-borderless" scope="col">customer</th>
                  <td class="address-col align-middle table-borderless" >address</td>
                  <td class="phone-col align-middle table-borderless">number</td>
                  <td class="phone-col align-middle table-borderless">order status</td>
                </tr>
              </tbody>
            </table>
            </div>
            {% for farmer in farmers %}
              <div class="display-4"><strong> {{ farmer.name }} </strong></div>
              <div class="ml-4">
                {% for customer in farmer.customers %}
                  <div class="display-4"> {{ customer.name }} - {{ customer.created_at }} </div>
                  <div class="ml-4">
                    {% for item in customer.get('items') %}
                      {% if item.name %}
                        <div class="border border-gray mb-2 mt-2 order-item-box">
                          <img src={{item.photo.S}} class="card-img-top float-left" style="max-width:190px; height:120px">
                            <span class="align-top list-inline-item float-left ml-2">
                              <p class="item-title display-4"> {{ item.price }} {{ item.name }} </p>
                              <p class="text-left"> Quantity: {{ item.qty }} </p>
                              <p class="text-left"> Revenue: {{ item.revenue }} </p>
                            </span>
                            <!-- <div class="form-group align-middle float-right m-1">
                              <textarea class="form-control notes-box" rows="7" id="order_notes"></textarea>
                            </div> -->
                        </div>
                      {% else %}
                        {% if not item.photo %}
                          <div class="alert alert-danger mb-0" role="alert">
                            <p> Meal with id: <strong>{{item.M.meal_id.S}}</strong> is no longer available or has been removed. </p>
                          </div>
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  </div>
                {% endfor %}
              </div>
            {% endfor %}

            {% if not orders %}
              <p class="lead text-secondary ml-4">You currently have no orders placed.</p>
            {% endif %}
            {% for order in orders %}
              {% set outer_loop = loop %}
              {% if outer_loop.index == 1%}
              <div class="border-top border-bottom ml-4 p-2 mb-1 mt-1" >
              {% else %}
              <div class="border-bottom ml-4 p-2 mb-1 mt-1" >
              {% endif %}
                <table class='table table-borderless mb-0'>
                  <tbody>
                    <tr>
                      <td class="time-col align-middle table-borderless" scope="col">{{ order.order_time }}</td>
                      <td id="kitchen_id{{outer_loop.index}}" class="phone-col align-middle table-borderless" scope="col">{{ order.kitchen_id.S }}</td>
                      <th class="name-col align-middle table-borderless" scope="col">{{ order.name.S }}</th>
                      <td class="address-col align-middle table-borderless" >
                        <div> {{ order.street.S }} </div>
                        <div> {{ order.city.S }}, {{ order.state.S }} {{ order.zipCode.N }} </div>
                      </td>
                      <td class="phone-col align-middle table-borderless" >{{ order.phone.S }}</td>
                      <td class="status-col align-middle table-borderless" >{{ order.status.S }}</td>
                      <td class="orderbtn-col align-middle">
                        <button class="btn btn-primary btn-sm float-right" type="button" data-toggle="collapse" data-target="#collapseExample{{loop.index}}" aria-expanded="false" aria-controls="collapseExample">
                          Order
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div class="order-details">
                  <div class="collapse" id="collapseExample{{outer_loop.index}}">
                    {% for item in order.order_items.L %}
                      {% if item.name %}
                        <div class="border border-gray mb-2 mt-2 order-item-box">
                          <img src={{item.photo.S}} class="card-img-top float-left" style="max-width:190px; height:120px">
                            <span class="align-top list-inline-item float-left ml-2">
                              <p class="item-title display-4"> {{ item.price }} {{ item.name }} </p>
                              <p class="text-left"> Quantity: {{ item.qty }} </p>
                              <p class="text-left"> Revenue: {{ item.revenue }} </p>
                            </span>
                            <!-- <div class="form-group align-middle float-right m-1">
                              <textarea class="form-control notes-box" rows="7" id="order_notes"></textarea>
                            </div> -->
                        </div>
                      {% else %}
                        {% if not item.photo %}
                          <div class="alert alert-danger mb-0" role="alert">
                            <p> Meal with id: <strong>{{item.M.meal_id.S}}</strong> is no longer available or has been removed. </p>
                          </div>
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>

          <div class="col-md-4 pr-4">
            <div class="content-section pr-4">
              <div class="border-bottom mb-4 d-flex justify-content-between">  <!-- this is spacing below Join Today text -->
                <span class="display-4 page-header-title">Current Statistics</span>
              </div>
              <table class="table table-borderless">
                <tbody>
                  <tr>
                    <th> Total Revenue: </th>
                    <th class="text-center"> {{ totalRevenue }} </th>
                  </tr>
                </tbody>
                <tbody>
                  <tr class="table-active">
                    <th> Item </th>
                    <th class="text-center" > Quantity Totals </th>
                  </tr>
                </tbody>
                {% for meal in todaysMeals %}
                  <tbody>
                    <tr>
                      <td class="text-muted"> {{ meal.meal_name.S }} </td>
                      {% if totalMealQuantity[meal.meal_id.S] %}
                        <td class="text-center text-muted"> {{ totalMealQuantity[meal.meal_id.S] }} </td>
                      {% else %}
                        <td class="text-center text-muted"> 0 </td>
                      {% endif %}
                    </tr>
                  </tbody>
                {% endfor %}
              </table>
              {% if not todaysMeals %}
                <h4 class="text-secondary">You currently have no meals made.</h4>
              {% endif %}
            </div>
          </div>
        </div>
      </main>
    {% endblock %}
  </body>
</html>
